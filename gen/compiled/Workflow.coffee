# generated by crampon

class Factory
  build: (tag) ->
    switch tag.tag
      when 'Workflow'
        Builder = Workflow
      when 'fieldUpdates'
        Builder = FieldUpdate
      when 'rules'
        Builder = Rule
      when 'actions'
        Builder = Action
      when 'criteriaItems'
        Builder = CriteriaItem
      when 'alerts'
        Builder = Alert
      when 'recipients'
        Builder = Recipient
      when 'workflowTimeTriggers'
        Builder = WorkflowTimeTrigger
      else throw new Error "unknown tag type #{tag.tag}"

    thing = new Builder()
    tag.getchildren().forEach (child) ->
      thing.set child.tag, child.text, child
    thing

factory = new Factory()

class Workflow
  constructor: ->
    @fieldUpdates = {}
    @rules = {}
  set: (field, value, tag) ->
    switch field
      when 'fieldUpdates'
        thing = factory.build tag
        @fieldUpdates[thing.fullName] = thing
      when 'rules'
        thing = factory.build tag
        @rules[thing.fullName] = thing
      else throw new Error "unknown field #{field} on Workflow object"

class FieldUpdate
  constructor: ->

  set: (field, value, tag) ->
    switch field
      when 'fullName'
        @fullName = value
      when 'description'
        @description = value
      when 'field'
        @field = value
      when 'formula'
        @formula = value
      when 'name'
        @name = value
      when 'notifyAssignee'
        @notifyAssignee = value is 'true'
      when 'operation'
        @operation = value
      when 'protected'
        @protected = value is 'true'
      else throw new Error "unknown field #{field} on fieldUpdates object"

class Rule
  constructor: ->

  set: (field, value, tag) ->
    switch field
      when 'fullName'
        @fullName = value
      when 'actions'
        @actions = value
      when 'active'
        @active = value is 'true'
      when 'criteriaItems'
        @criteriaItems = value
      when 'description'
        @description = value
      when 'triggerType'
        @triggerType = value
      else throw new Error "unknown field #{field} on rules object"

class Action
  constructor: ->

  set: (field, value, tag) ->
    switch field
      when 'name'
        @name = value
      when 'type'
        @type = value
      else throw new Error "unknown field #{field} on actions object"

class CriteriaItem
  constructor: ->

  set: (field, value, tag) ->
    switch field
      when 'field'
        @field = value
      when 'operation'
        @operation = value
      else throw new Error "unknown field #{field} on criteriaItems object"

class Alert
  constructor: ->

  set: (field, value, tag) ->
    switch field
      when 'fullName'
        @fullName = value
      when 'description'
        @description = value
      when 'protected'
        @protected = value is 'true'
      when 'recipients'
        @recipients = value
      when 'senderType'
        @senderType = value
      when 'template'
        @template = value
      else throw new Error "unknown field #{field} on alerts object"

class Recipient
  constructor: ->

  set: (field, value, tag) ->
    switch field
      when 'recipient'
        @recipient = value
      when 'type'
        @type = value
      else throw new Error "unknown field #{field} on recipients object"

class WorkflowTimeTrigger
  constructor: ->

  set: (field, value, tag) ->
    switch field
      when 'actions'
        @actions = value
      when 'offsetFromField'
        @offsetFromField = value
      when 'timeLength'
        @timeLength = parseInt value, 10
      when 'workflowTimeTriggerUnit'
        @workflowTimeTriggerUnit = value
      else throw new Error "unknown field #{field} on workflowTimeTriggers object"

module.exports = factory
